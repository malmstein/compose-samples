name: Repo updated

on:
  workflow_dispatch:

jobs:
  find-latest-version:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.latest-release.outputs.version }}
    steps:
      - name: Find latest release of content scope scripts
        id: latest-release
        uses: malmstein/github-asana-action@master
        with:
          github-pat: ${{ secrets.GT_DAXMOBILE }}
          github-repository: 'github-asana-action'
          github-org: 'malmstein'
          action: 'get-latest-repo-release'

  create-pr:
    name: Create Pull Request in Android repo
    runs-on: ubuntu-latest
    needs: find-latest-version
    env:
      VERSION: ${{needs.find-latest-version.outputs.version}}
    steps:
      - name: Create Asana task when workflow succeeded
        uses: honeycombio/gha-create-asana-task@main
        with:
          asana-secret: ${{ secrets.GH_ASANA_SECRET }}
          asana-workspace-id: '137249556945'
          asana-project-id: '1174433894299346'
          asana-section-id: '1202853880411179'
          asana-task-name: Update content scope scripts to version ${{ env.VERSION }}
          asana-task-description: |
            Content scope scripts have been updated and a PR created.
            
            If tests failed check out https://app.asana.com/0/1202561462274611/1203986899650836/f for further information on what to do next.
            
            See ${{ steps.create-pr.outputs.pull-request-url }}
